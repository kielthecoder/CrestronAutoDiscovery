/*
Dealer Name: IMT
System Name:
System Number:
Programmer: Kiel Lofstrand
Comments:
*/

// COMPILER DIRECTIVES /////////////////////////////////////////////////////////////////////

#ENABLE_DYNAMIC
#DEFAULT_VOLATILE
#ENABLE_STACK_CHECKING
#ENABLE_TRACE
// #DIGITAL_EXPAND 
// #ANALOG_SERIAL_EXPAND 

/*
#HELP_BEGIN
   (add additional lines of help lines)
#HELP_END
*/

// LIBRARIES ///////////////////////////////////////////////////////////////////////////////

#USER_SIMPLSHARP_LIBRARY "AutoDiscoveryLib"

// INPUTS //////////////////////////////////////////////////////////////////////////////////

STRING_INPUT Address[255];
ANALOG_INPUT Port;

DIGITAL_INPUT Start;
DIGITAL_INPUT Stop;

STRING_INPUT  My_Hostname[255];
STRING_INPUT  My_IPv4[255];
STRING_INPUT  My_Description[255];

// OUTPUTS /////////////////////////////////////////////////////////////////////////////////

DIGITAL_OUTPUT Active_Fb;

// SOCKETS /////////////////////////////////////////////////////////////////////////////////

// PARAMETERS //////////////////////////////////////////////////////////////////////////////

// STRUCTURES //////////////////////////////////////////////////////////////////////////////

DiscoveryAgent Discovery;

// GLOBAL VARIABLES ////////////////////////////////////////////////////////////////////////

// FUNCTIONS ///////////////////////////////////////////////////////////////////////////////

// EVENT HANDLERS //////////////////////////////////////////////////////////////////////////

THREADSAFE PUSH Start
{
	Discovery.Start(Address, Port);
	Active_Fb = Discovery.Active;
}

THREADSAFE PUSH Stop
{
	Discovery.Stop();
	Active_Fb = Discovery.Active;
}

CHANGE My_Hostname
{
	Discovery.Hostname = My_Hostname;
}

CHANGE My_IPv4
{
	Discovery.IPv4 = My_IPv4;
}

CHANGE My_Description
{
	Discovery.Description = My_Description;
}

// CALLBACKS AND DELEGATES /////////////////////////////////////////////////////////////////

// MAIN ////////////////////////////////////////////////////////////////////////////////////

FUNCTION Main()
{
	WaitForInitializationComplete();
}
